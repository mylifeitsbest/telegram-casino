<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–∑–∏–Ω–æ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-button-color: #3390ec;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #f0f0f0;
            --tg-theme-hint-color: #999999;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .balance {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--tg-theme-text-color);
        }

        .slot-machine {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            padding: 20px;
            background-color: var(--tg-theme-secondary-bg-color);
            border-radius: 10px;
        }

        .reel {
            width: 80px;
            height: 80px;
            background-color: white;
            border: 2px solid var(--tg-theme-button-color);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            position: relative;
            overflow: hidden;
        }

        .reel.spinning {
            animation: spin 0.5s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: translateY(-100%);
            }
            100% {
                transform: translateY(100%);
            }
        }

        .controls {
            margin: 20px 0;
        }

        input[type="number"] {
            padding: 10px;
            font-size: 18px;
            width: 100px;
            margin-right: 10px;
            border: 2px solid var(--tg-theme-button-color);
            border-radius: 5px;
        }

        button {
            padding: 10px 20px;
            font-size: 18px;
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .result {
            font-size: 24px;
            margin: 20px 0;
            min-height: 36px;
        }

        .error {
            color: red;
            margin: 10px 0;
        }

        .debug {
            background-color: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            color: #666;
        }

        .winning-combinations {
            margin: 20px 0;
            padding: 20px;
            background-color: var(--tg-theme-secondary-bg-color);
            border-radius: 10px;
        }

        .winning-combinations h3 {
            margin-top: 0;
        }

        .combination {
            margin: 10px 0;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="balance">
            –ë–∞–ª–∞–Ω—Å: <span id="balance">10000</span> –º–æ–Ω–µ—Ç
        </div>

        <div class="slot-machine">
            <div class="reel" id="reel1">üé∞</div>
            <div class="reel" id="reel2">üé∞</div>
            <div class="reel" id="reel3">üé∞</div>
        </div>

        <div class="controls">
            <input type="number" id="betAmount" placeholder="–°—Ç–∞–≤–∫–∞" min="1" value="100">
            <button id="spinButton" onclick="spin()">–ö—Ä—É—Ç–∏—Ç—å</button>
        </div>

        <div class="result" id="result"></div>

        <div class="winning-combinations">
            <h3>–í—ã–∏–≥—Ä—ã—à–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:</h3>
            <div class="combination">777 - x10</div>
            <div class="combination">üçíüçíüçí - x5</div>
            <div class="combination">üçäüçäüçä - x3</div>
            <div class="combination">üçãüçãüçã - x2</div>
            <div class="combination">üçáüçáüçá - x2</div>
        </div>

        <div class="debug" id="debug"></div>
    </div>

    <script>
        // –°–∏–º–≤–æ–ª—ã –¥–ª—è —Å–ª–æ—Ç-–º–∞—à–∏–Ω—ã
        const SYMBOLS = ['7', 'üçí', 'üçä', 'üçã', 'üçá'];
        
        // –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ –¥–ª—è –≤—ã–∏–≥—Ä—ã—à–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
        const WINNING_COMBINATIONS = {
            '777': 10,
            'üçíüçíüçí': 5,
            'üçäÔøΩÔøΩüçä': 3,
            'üçãüçãÔøΩÔøΩ': 2,
            'üçáüçáüçá': 2
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ WebApp —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
        if (!tg) {
            showError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp');
            console.error('Telegram WebApp –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        } else {
            // –í–∫–ª—é—á–∞–µ–º –æ—Ç–ª–∞–¥–∫—É
            tg.enableClosingConfirmation();
            tg.expand();
            
            // –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            showDebug('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
            showDebug('–í–µ—Ä—Å–∏—è: ' + tg.version);
            showDebug('–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ' + tg.platform);
            showDebug('–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞: ' + tg.colorScheme);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
            document.documentElement.style.setProperty('--tg-theme-bg-color', tg.backgroundColor || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-text-color', tg.textColor || '#000000');
            document.documentElement.style.setProperty('--tg-theme-button-color', tg.buttonColor || '#3390ec');
            document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.buttonTextColor || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', tg.secondaryBackgroundColor || '#f0f0f0');
            document.documentElement.style.setProperty('--tg-theme-hint-color', tg.hintColor || '#999999');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞
            tg.onEvent('web_app_data_send', handleBotResponse);
            
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å —É –±–æ—Ç–∞
            try {
                tg.sendData(JSON.stringify({ action: 'get_balance' }));
                showDebug('–ó–∞–ø—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
            } catch (e) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –±–∞–ª–∞–Ω—Å–∞: ' + e.message);
                showDebug('–û—à–∏–±–∫–∞: ' + e.message);
            }
        }

        function calculateWin(symbols) {
            const combination = symbols.join('');
            return WINNING_COMBINATIONS[combination] || 0;
        }

        function handleBotResponse(event) {
            try {
                const data = JSON.parse(event.data);
                showDebug('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç –±–æ—Ç–∞: ' + JSON.stringify(data));
                
                if (data.balance !== undefined) {
                    updateBalance(data.balance);
                }
                
                if (data.win_amount !== undefined) {
                    if (data.win_amount > 0) {
                        showWin(data.win_amount, data.multiplier);
                    } else {
                        showLoss();
                    }
                }
            } catch (e) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞: ' + e.message);
                showDebug('–û—à–∏–±–∫–∞: ' + e.message);
            }
        }

        function updateBalance(newBalance) {
            const balanceElement = document.getElementById('balance');
            if (balanceElement) {
                balanceElement.textContent = newBalance;
                showDebug('–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ' + newBalance);
            }
        }

        function showWin(amount, multiplier) {
            const resultElement = document.getElementById('result');
            if (resultElement) {
                resultElement.textContent = `ÔøΩÔøΩ –í—ã–∏–≥—Ä—ã—à: ${amount} (x${multiplier})`;
                resultElement.style.color = 'green';
                showDebug('–ü–æ–∫–∞–∑–∞–Ω –≤—ã–∏–≥—Ä—ã—à: ' + amount);
            }
        }

        function showLoss() {
            const resultElement = document.getElementById('result');
            if (resultElement) {
                resultElement.textContent = 'üò¢ –ù–µ—Ç –≤—ã–∏–≥—Ä—ã—à–∞';
                resultElement.style.color = 'red';
                showDebug('–ü–æ–∫–∞–∑–∞–Ω –ø—Ä–æ–∏–≥—Ä—ã—à');
            }
        }

        function spin() {
            const betInput = document.getElementById('betAmount');
            const bet = parseInt(betInput.value);
            
            if (isNaN(bet) || bet <= 0) {
                showError('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏');
                return;
            }
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏
            const spinButton = document.getElementById('spinButton');
            spinButton.disabled = true;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∏–º–≤–æ–ª—ã
            const symbols = [];
            for (let i = 0; i < 3; i++) {
                const randomIndex = Math.floor(Math.random() * SYMBOLS.length);
                symbols.push(SYMBOLS[randomIndex]);
            }
            
            // –ê–Ω–∏–º–∏—Ä—É–µ–º –±–∞—Ä–∞–±–∞–Ω—ã
            animateReels(symbols, () => {
                // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
                try {
                    tg.sendData(JSON.stringify({
                        action: 'spin',
                        bet_amount: bet,
                        symbols: symbols
                    }));
                    showDebug('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –±–æ—Ç—É');
                } catch (e) {
                    showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö: ' + e.message);
                    showDebug('–û—à–∏–±–∫–∞: ' + e.message);
                }
                
                // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ–±—Ä–∞—Ç–Ω–æ
                spinButton.disabled = false;
            });
        }

        function animateReels(symbols, callback) {
            const reels = document.querySelectorAll('.reel');
            let completedReels = 0;
            
            reels.forEach((reel, index) => {
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
                reel.classList.add('spinning');
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
                setTimeout(() => {
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                    reel.classList.remove('spinning');
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∏–º–≤–æ–ª
                    reel.textContent = symbols[index];
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –±–∞—Ä–∞–±–∞–Ω–æ–≤
                    completedReels++;
                    
                    // –ï—Å–ª–∏ –≤—Å–µ –±–∞—Ä–∞–±–∞–Ω—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å, –≤—ã–∑—ã–≤–∞–µ–º callback
                    if (completedReels === reels.length) {
                        callback();
                    }
                }, 1000 + (index * 500)); // –ó–∞–¥–µ—Ä–∂–∫–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –±–∞—Ä–∞–±–∞–Ω–∞
            });
        }

        function showError(message) {
            const errorElement = document.getElementById('error');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
                setTimeout(() => {
                    errorElement.style.display = 'none';
                }, 3000);
            }
        }

        function showDebug(message) {
            const debugElement = document.getElementById('debug');
            if (debugElement) {
                debugElement.textContent = message;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Å—Ç–∞–≤–∫–∏
        document.getElementById('betAmount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                spin();
            }
        });
    </script>
</body>
</html> 
